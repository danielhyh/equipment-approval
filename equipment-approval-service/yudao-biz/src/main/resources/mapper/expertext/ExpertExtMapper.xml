<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.iocoder.yudao.module.biz.dal.mysql.expertext.ExpertExtMapper">

    <!--
        一般情况下，尽可能使用 Mapper 进行 CRUD 增删改查即可。
        无法满足的场景，例如说多表关联查询，才使用 XML 编写 SQL。
        代码生成器暂时只生成 Mapper XML 文件本身，更多推荐 MybatisX 快速开发插件来生成查询。
        文档可见：https://www.iocoder.cn/MyBatis/x-plugins/
     -->

    <select id="page" resultType="cn.iocoder.yudao.module.biz.controller.admin.expertext.vo.ExpertExtRespVO">
        SELECT
            a.id,
            a.name,
            a.gender,
            a.age,
            a.unit,
            a.title,
            a.position,
            a.specialty,
            a.phone,
            a.create_time,
            COUNT(b.id) AS review_nums,
            a.remark
        FROM
            biz_expert_ext a
              LEFT  JOIN
            biz_application b
            ON
                FIND_IN_SET(a.id, b.expert_id) > 0
        where a.deleted = 0
        GROUP BY
            a.id, a.name, a.gender, a.unit, a.title, a.position, a.specialty, a.phone, a.create_time
    </select>

    <select id="list" resultType="cn.iocoder.yudao.module.biz.controller.admin.expertext.vo.ExpertExtRespVO">
        select
            id,
            name,
            gender,
            unit,
            title,
            specialty
        from biz_expert_ext
        where deleted = 0
        <if test="keyword != null and keyword != ''">
            and (unit like concat('%', #{keyword}, '%') or name like concat('%', #{keyword}, '%'))
        </if>
        <if test="specialty != null and specialty != ''">
            and specialty = #{specialty}
        </if>
    </select>

    <select id="selectReviewRecord" resultType="cn.iocoder.yudao.module.biz.controller.admin.expertext.vo.ExpertReviewVO">
        select expert_review_time , app_status ,
               a.license_device_name ,institution_name, app_no
        from biz_application a
        left join biz_institution_ext b on a.institution_id = b.dept_id
        where find_in_set(#{id}, expert_id)
    </select>

</mapper>